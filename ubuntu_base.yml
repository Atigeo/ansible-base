---
- name: Ubuntu Base
  hosts: hosts
  sudo: True
  vars:
   
    install_docker: True
  
    install_java: false
    java_location: /usr/lib/jvm

  tasks:

# ---- Download Certs -------------------------------------

    - name: Get GeoTrust Global CA - 02:34:56
      get_url: url=https://knowledge.geotrust.com/library/VERISIGN/INTERNATIONAL_AFFILIATES/GeoTrust/GeoTrust_Global_CA.pem dest=/usr/local/share/ca-certificates/GeoTrustGlobalCA.crt
      notify: load_certs

    - name: Get GeoTrust SSL CA - G3 
      get_url: url=https://knowledge.geotrust.com/library/VERISIGN/ALL_OTHER/Cliff/TU85/GEOTRUST_CAcerts/certs/GeoTrust_SSL_CA_-_G3.cer dest=/usr/local/share/ca-certificates/GeoTrustSSLCA-G3.crt
      notify: load_certs


# ---- Install Docker -------------------------------------

    - name: Setup apt for docker
      apt_key: keyserver=hkp://p80.pool.sks-keyservers.net:80 id=58118E89F3A912897C070ADBF76221572C52609D
      when: install_docker

    - name: Add entry to /etc/apt/sources.list.d/docker.list
      lineinfile: dest=/etc/apt/sources.list.d/docker.list line="deb https://apt.dockerproject.org/repo ubuntu-trusty main"
      when: install_docker 

    - name: Install docker
      apt: name=docker-engine update_cache=yes state=latest


# ---- Install Java ---------------------------------------

    - name: Download Java
      command: 'wget --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/7u80-b15/jdk-7u80-linux-x64.tar.gz -P /tmp/'
      when: install_java

    - name: Create directory
      file: path={{ java_location }} state=directory mode=755
      when: install_java

    - name: Extract tar file
      unarchive: src=/tmp/jdk-7u80-linux-x64.tar.gz dest={{ java_location }} copy=no
      when: install_java

    - name: Add java to /usr/bin/
      alternatives: name=java path={{ java_location }}/jdk1.7.0_80/bin/java link=/usr/bin/java
      when: install_java

    - name: Add jps to /usr/bin/
      alternatives: name=jps path={{ java_location }}/jdk1.7.0_80/bin/jps link=/usr/bin/jps
      when: install_java

    - name: Create java home
      lineinfile: dest=/etc/environment line="export JAVA_HOME={{ java_location }}/jdk1.7.0_80"
      when: install_java


  handlers:

# ---- Load the certs -------------------------------------

    - name: load_certs
      shell: /usr/sbin/update-ca-certificates
